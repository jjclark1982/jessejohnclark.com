<!DOCTYPE html>
<html>
  <head>
    <title>Conditional Live-Reload with Metalsmith CLI | Jesse Clark’s Blog</title>
    <link rel="stylesheet" href="/assets/normalize.css">
    <link rel="stylesheet" href="/assets/hljs-github.css">
    <link rel="stylesheet" href="/assets/style.css">
  </head>
  <body>
    <div class="container">
      <header>
        <h1><a href="/">Jesse Clark’s Blog</a></h1>
      </header>
      <article>
        <header>
          <h2><a href="/posts/2014/conditional-live-reload-with-metalsmith-cli/">Conditional Live-Reload with Metalsmith CLI</a></h2>
          <div class="author">by <span class="author-name">Jesse Clark</span></div>
          <div class="time">Published 
            <time class="published" datetime="2014-11-18T00:00:00.000Z">November 18, 2014</time>
          </div>
          <div class="time">Last edited 
            <time class="modified" datetime="2022-12-28T10:15:07.376Z">December 28, 2022 9:15 PM</time>
          </div>
        </header><p><a href="http://www.metalsmith.io/">Metalsmith</a> is a popular static site generator.</p>
<p>The <code>metalsmith</code> command-line interface allows a build process to be defined by a single JSON file. If you want to vary the build process in different situations, you need to write a script that duplicates much of the logic of the CLI. It&#39;s possible to avoid duplication by requiring the CLI binary from another script. This gives us an opportunity to modify the config with conditional or non-serializable data:</p>
<!-- more -->

<pre><code class="language-JavaScript">var config = require(&#39;./metalsmith.json&#39;);
// provide a formatting function for use in templates
config.metadata.formatDate = function(date, format) {
    return require(&quot;moment&quot;)(date).format(format || &quot;MMMM Do, YYYY&quot;);
}
// only enable live-reloading when requested
if (process.env.AUTO_RELOAD) {
    config.plugins[&#39;metalsmith-watch&#39;] = { livereload: 35729 };
    config.metadata.customHTML = &#39;&lt;script src=&quot;http://localhost:35729/livereload.js?snipver=1&quot;&gt;&lt;/script&gt;&#39;);
}

// run the standard CLI
require(&#39;metalsmith/bin/metalsmith&#39;);
</code></pre>
<p>This lets us use the same general config for both batch processing and live-reloading, which would otherwise be incompatible.</p>
<pre><code class="language-Bash">node build.js                  # terminates after building
AUTO_RELOAD=1 node build.js    # keeps running until killed
</code></pre>

      </article>
      <nav>
        <div class="widget"><ul>
<li><a href="jobs/">R&eacute;sum&eacute;</a></li>
<li><a href="/posts">Blog</a> (<a href="/rss.xml">RSS Feed</a>)</li>
<li><a href="http://www.linkedin.com/profile/view?id=5026500">LinkedIn</a></li>
<li><a href="http://github.com/jjclark1982">GitHub</a></li>
<li><a href="http://stackoverflow.com/users/503963/phssthpok">Stack Overflow</a></li>
<li><a href="http://myhf.newsblur.com/">NewsBlur</a></li>
<li><a href="https://foursquare.com/myhf">Foursquare</a></li>
<li><a href="http://www.facebook.com/jesse.j.clark">Facebook</a></li>
<li><a href="http://www.google.com/profiles/jjclark1982">Google Plus</a></li>
<li><a href="http://old.thesixtyone.com/#/Phssthpok/">thesixtyone</a></li>
<li><a href="http://open.spotify.com/user/jjclark1982">Spotify</a></li>
<li><a href="https://twitter.com/spelunkyadvice">Bad Spelunky Advice</a></li>
</ul>
</div>
      </nav>
    </div>
  </body>
</html>