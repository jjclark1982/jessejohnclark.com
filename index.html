<!DOCTYPE html><html><head><title>Jesse Clark’s Blog</title><link rel="stylesheet" href="/assets/style.css"></head><body><div class="container"><header><h1><a href="/">Jesse Clark’s Blog</a></h1></header><article><header><h2><a href="/posts/conditional-live-reload-with-metalsmith-cli">Conditional Live-Reload with Metalsmith CLI</a></h2><div class="time">Published <time datetime="Mon Nov 17 2014 16:00:00 GMT-0800 (PST)" class="published">November 17, 2014</time></div></header><p><a href="http://www.metalsmith.io/">Metalsmith</a> is a popular static site generator.</p>
<p>The <code>metalsmith</code> command-line interface allows a build process to be defined by a single JSON file. If you want to vary the build process in different situations, you need to write a script that duplicates much of the logic of the CLI. It&#39;s possible to avoid duplication by requiring the CLI binary from another script. This gives us an opportunity to modify the config with conditional or non-serializable data:</p>
<pre><code><span class="hljs-keyword">var</span> config = require(<span class="hljs-string">'./metalsmith.json'</span>);
<span class="hljs-comment">// provide a formatting function for use in templates</span>
config.metadata.formatDate = function(date, format) {
    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">require</span><span class="hljs-params">(<span class="hljs-string">"moment"</span>)</span><span class="hljs-params">(date)</span>.<span class="hljs-title">format</span><span class="hljs-params">(format || <span class="hljs-string">"MMMM Do, YYYY"</span>)</span></span>;
}
<span class="hljs-comment">// only enable live-reloading when requested</span>
<span class="hljs-keyword">if</span> (process.env.AUTO_RELOAD) {
    config.plugins[<span class="hljs-string">'metalsmith-watch'</span>] = { livereload: <span class="hljs-number">35729</span> };
    config.metadata.customHTML = <span class="hljs-string">'&lt;script src="http://localhost:35729/livereload.js?snipver=1"&gt;&lt;/script&gt;'</span>);
}

<span class="hljs-comment">// run the standard CLI</span>
require(<span class="hljs-string">'metalsmith/bin/metalsmith'</span>);</code></pre>

<p>This lets us use the same general config for both batch processing and live-reloading, which would otherwise be incompatible.</p>
<pre><code><span class="hljs-keyword">node</span> build.js                  <span class="hljs-comment"># terminates after building</span>
<span class="hljs-constant">A</span>UTO_RELOAD=<span class="hljs-number">1</span> <span class="hljs-keyword">node</span> build.js    <span class="hljs-comment"># keeps running until killed</span></code></pre><a href="/posts/conditional-live-reload-with-metalsmith-cli">Read on →</a></article><article><header><h2><a href="/posts/bad-joke-eel">Bad Joke Eel</a></h2><div class="time">Published <time datetime="Fri May 11 2012 19:36:00 GMT-0700 (PDT)" class="published">May 11, 2012</time></div></header><p><img src='/awkward-zippers/40992127-ys9CA.jpeg'></p>
<a href="/posts/bad-joke-eel">Read on →</a></article><article><header><h2><a href="/posts/lady-gaga-wearing-nothing-but-zippers">Lady Gaga wearing nothing but zippers</a></h2><div class="time">Published <time datetime="Thu Apr 21 2011 00:44:00 GMT-0700 (PDT)" class="published">April 21, 2011</time></div></header><p><img src='/awkward-zippers/24993178-blog190211_gaga.jpg'></p>
<a href="/posts/lady-gaga-wearing-nothing-but-zippers">Read on →</a></article><article><header><h2><a href="/posts/my-phone-location-history">My phone location history</a></h2><div class="time">Published <time datetime="Wed Apr 20 2011 14:13:00 GMT-0700 (PDT)" class="published">April 20, 2011</time></div></header><p><img src='/posterous-import/2011/04/24973318-Screen shot 2011-04-20 at 2.11.37 PM.png'></p>
<p>Extracted with <a href="http://petewarden.github.com/iPhoneTracker/">http://petewarden.github.com/iPhoneTracker/</a></p>
<a href="/posts/my-phone-location-history">Read on →</a></article><article><header><h2><a href="/posts/homemade-record-player">Homemade record player</a></h2><div class="time">Published <time datetime="Tue Mar 22 2011 11:20:00 GMT-0700 (PDT)" class="published">March 22, 2011</time></div></header><p><strong>p67.mov</strong>
<a href="/posterous-import/2011/03/361408-p67.mov">Watch this video</a></p>
<p>We rolled a sheet of paper into a cone, attached a sewing needle to the tip with candle wax, and held it up to a record spinning on a bicycle wheel.</p>
<a href="/posts/homemade-record-player">Read on →</a></article><article><header><h2><a href="/posts/candy-cigarettes">Candy cigarettes</a></h2><div class="time">Published <time datetime="Mon Mar 14 2011 21:54:00 GMT-0700 (PDT)" class="published">March 14, 2011</time></div></header><p><img src='/posterous-import/2011/03/23009363-p60.jpg'></p>
<p><img src='/posterous-import/2011/03/23009364-p62.jpg'></p>
<a href="/posts/candy-cigarettes">Read on →</a></article><article><header><h2><a href="/posts/eye-pad-two">Eye Pad Two</a></h2><div class="time">Published <time datetime="Fri Mar 11 2011 15:48:00 GMT-0800 (PST)" class="published">March 11, 2011</time></div></header><p><img src='/posterous-import/2011/03/22854214-p43.jpg'></p>
<a href="/posts/eye-pad-two">Read on →</a></article><article><header><h2><a href="/posts/i-fell-off-the-wagon">I fell off the wagon</a></h2><div class="time">Published <time datetime="Fri Mar 04 2011 00:52:00 GMT-0800 (PST)" class="published">March 4, 2011</time></div></header><p><img src='/posterous-import/2011/03/22467201-p37.jpg'></p>
<a href="/posts/i-fell-off-the-wagon">Read on →</a></article><article><header><h2><a href="/posts/whose-keychain-is-this">Whose keychain is this?</a></h2><div class="time">Published <time datetime="Wed Feb 16 2011 01:09:00 GMT-0800 (PST)" class="published">February 16, 2011</time></div></header><p><div class='post_body'>I found this under my couch. It has probably been there for years.<p><div class='p_embed p_image_embed'>
<img src='/posterous-import/2011/02/21643900-photo.JPG'></p>
<a href="/posts/whose-keychain-is-this">Read on →</a></article><article><header><h2><a href="/posts/groovy-fruits">Groovy Fruits</a></h2><div class="time">Published <time datetime="Mon Feb 07 2011 23:28:00 GMT-0800 (PST)" class="published">February 7, 2011</time></div></header><p>Groovy Fruits is now available on the App Store. Enjoy!&nbsp;<span style="font-family: Lucida Grande, sans-serif; color: #444444; line-height: 20px;"><a href="http://www.groovyfruits.com/">http://www.groovyfruits.com/</a></span></span></p></div></p>
<a href="/posts/groovy-fruits">Read on →</a></article><div><span>&nbsp;</span><b><a href="/index.html">Page 1</a></b><span>&nbsp;</span><a href="/posts/2/index.html">| Next Page »</a></div><nav><div class="widget"><ul>
<li><a href="jobs/">R&eacute;sum&eacute;</a></li>
<li><a href="/posts">Blog</a> (<a href="/rss.xml">RSS Feed</a>)</li>
<li><a href="http://www.linkedin.com/profile/view?id=5026500">LinkedIn</a></li>
<li><a href="http://github.com/jjclark1982">GitHub</a></li>
<li><a href="https://bugzilla.mozilla.org/buglist.cgi?query_format=advanced&amp;field0-0-0=attachments.submitter&amp;type0-0-0=equals&amp;value0-0-0=jjclark1982%40gmail.com">Bugzilla</a></li>
<li><a href="http://stackoverflow.com/users/503963/phssthpok">Stack Overflow</a></li>
<li><a href="http://myhf.newsblur.com/">NewsBlur</a></li>
<li><a href="https://foursquare.com/myhf">Foursquare</a></li>
<li><a href="http://www.facebook.com/jesse.j.clark">Facebook</a></li>
<li><a href="http://www.google.com/profiles/jjclark1982">Google Plus</a></li>
<li><a href="http://old.thesixtyone.com/#/Phssthpok/">thesixtyone</a></li>
<li><a href="http://open.spotify.com/user/jjclark1982">Spotify</a></li>
<li><a href="https://twitter.com/spelunkyadvice">Bad Spelunky Advice</a></li>
</ul>
</div></nav></div></body></html>